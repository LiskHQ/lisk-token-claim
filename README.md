# Lisk Token Claim

This library builds Merkle Tree and build Merkle Root

## Installation

```
$ yarn
```

## Run

```
$ yarn generate-merkle-tree             # Using ./data/mainnet
$ yarn generate-merkle-tree-testing     # Using ./data/example
```

## Files

| Name                                      | Description                                         | Generated By                  |
| ----------------------------------------- | --------------------------------------------------- | ----------------------------- |
| `/data/<network>/balance.json`            | Stores balance by address after a snapshot is taken | Snapshot                      |
| `/data/<network>/merkle-tree-result.json` | Stores MerkleRoot, and node for each account        | `$ yarn generate-merkle-tree` |

## Merkle Node

Each node will be encoded as:

```
<LSK_ADDRESS_IN_HEX><BALANCE_IN_BEDDOWS><NUMBER_OF_SIGNATURES><MANDATORY_KEYS><OPTIONAL_KEYS>
P.S. If the address is not a multisig address, NUMBER_OF_SIGNATURES would be 0
```

## Params

```
balance.json:
{
    lskAddress: string;
    balance: number;
    numberOfSignatures?: number;
    mandatoryKeys?: string[];
    optionalKeys?: string[];
}

merkle-tree-result.json:
{
    merkleRoot: string;
    nodes: {
        lskAddress: string;
        address: string;
        balance: number;
        balanceBeddows: number;
        numberOfSignatures: number;
        mandatoryKeys: string[];
        optionalKeys: string[];
        payload: string;
        hash: string;
        proof: string[];
    }[];
}
```

## _Testing Only_

### Generate balance.json from `dev-validators.json`

```
$ yarn create-balances-testing
```

### (After running `generate-merkle-tree`) Sign all accounts

```
$ yarn sign-testing
```

### `merkle-tree-simple`

Due to the constraint of vm.parseJson in Foundry, fields in `merkle-tree-result` such as decimal field will trigger error.

`merkle-tree-simple.json` is a lightweight version of `merkle-tree.json`, which also has sufficient params for claiming.
